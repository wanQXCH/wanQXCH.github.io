<!DOCTYPE html>
<html>
<head>
    <title>Redirecting...</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const encrypted = urlParams.get('code');
            const key = urlParams.get('key');

            if (!encrypted || !key) {
                document.body.innerHTML = '<h1>缺少必要参数</h1>';
                return;
            }

            try {
                // AES解密
                const decrypted = CryptoJS.AES.decrypt(
                    decodeURIComponent(encrypted),
                    decodeURIComponent(key)
                ).toString(CryptoJS.enc.Utf8);

                // 安全校验
                if (!decrypted || !/^https?:\/\//i.test(decrypted)) {
                    throw new Error('无效的URL');
                }

                // 执行跳转
                window.location.replace(decrypted);
            } catch (e) {
                document.body.innerHTML = '<h1>解密失败或链接无效</h1>';
            }
        })();
    </script>
</head>
<body>
    <noscript>请启用JavaScript以完成跳转</noscript>
</body>
</html>
